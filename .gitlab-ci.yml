image: node:lts

stages:
  - build
  - test

cache:
  paths:
    - node_modules/
    - .yarn

Install dependencies:
  stage: .pre
  script:
    - yarn config set cache-folder .yarn
    - yarn install

Build:
  stage: build
  before_script:
    - yarn config set cache-folder .yarn
  script:
    - yarn run build --prod --aot initial-project
    - yarn run build --prod --aot refactored-solution

Test:
  stage: test
  before_script:
    - yarn config set cache-folder .yarn
    - apt-get update
    - apt-get install -yq xvfb libgtk2.0-0 libxtst6 libxss1 libgconf-2-4 libnss3 libasound2
  script:
    - yarn run test:ci initial-project
    - yarn run test:ci refactored-solution
